@model LMS.Models.AuthorMaster
@{
    ViewBag.Title = "Index";
}

<center><h2>Author Master</h2></center>
<div class="p-2">
   <a class="btn btn-success" style="margin-bottom:10px" onclick="PopupForm('@Url.Action("InsertOrUpdate")/0')"><i class="fa fa-plus"></i> Add New</a>
   <table id="AuthorMasterTable" class="table table-striped table-bordered" style="width:100%">
       <thead>
           <tr>
               <th>Id</th>
               <th>Name</th>
               <th>IsDeleted</th>
               <th>Control</th>
           </tr>
       </thead>
   </table>
</div>

@section scripts{
   <script type="text/javascript">
      var Popup, dataTable;
      $(document).ready(function () {
         bindDatatable();
      });

      function bindDatatable()
      {
         dataTable =  $("#AuthorMasterTable").DataTable({
            "ajax": {
               "url": "/AuthorMaster/GetData",
               "type": "GET",
               "datatype": "json"
            },
            "columns": [
               { "data": "Id" },
               { "data": "Name" },
               { "data": "IsDeleted" },
               { "data": "Id" ,
               "render" : function (data) {
                  return "<a class='btn btn-default btn-sm' onclick=PopupForm('@Url.Action("InsertOrUpdate")/" + data + "')>"
                  + " <i class='fa fa-pencil'></i> Edit</a>"
                  + " <a class='btn btn-danger btn-sm' style='margin-left:5px' onclick=Delete("+data+")><i class='fa fa-trash'></i> Delete</a>";
               },
                  "orderable": false,
                  "searchable":true,
                  "width":"150px"
               }
            ],
            "language": {
               "emptyTable" : "No authors found, Please click on <b>Add New</b> Button",  
               "processing" : "<i class='fa fa-spinner fa-spin fa-3x fa-fw' style='color:#2a2b2b;'></i><span class='sr-only'>Loading...</span>" 
            }
         });
      };

      function PopupForm(url) {
         debugger;
         var formDiv = $('<div id="PopupForm" class="container border-1"/>');
         $.get(url)
         .done(function (response) {
            debugger;
            formDiv.html(response);
            Popup = formDiv.dialog({
               autoOpen: true,
               resizable: false,
               title: 'Fill Author Details',
               height: 500,
               width: 700,
               close: function () {
                  Popup.dialog('destroy').remove();
               }
            });
         });
      }

        function SubmitForm(form) {
         debugger;
         $.validator.unobtrusive.parse(form);
         if($(form).valid()){
            $.ajax({
               type : "POST",
               url : form.action,
               data : $(form).serialize(),
               success : function (data) {
                  if(data.success)
                  {
                     Popup.dialog('close');
                     dataTable.ajax.reload();

                     $.notify(data.message,{
                        globalPosition :"top right",
                        className : "success"
                     })
                  }
                  else
                  {
                     $.notify(data.message,{
                        globalPosition :"top right",
                        className : "error"
                     })
                  }
               }
            });
         }
         return false;
      }

      function Delete(id) {
         if(confirm('Are You Sure to Delete this AuthorMaster Record ?'))
         {
            $.ajax({
               type: "POST",
               data: { "Id": id, "IsDeleted": true },
               url: '@Url.Action("InsertUpdateOrDelete","AuthorMaster")',
               success: function (data) {
                  if (data.success)
                  {
                     dataTable.ajax.reload();
                     $.notify(data.message, {
                        globalPosition: "top right",
                        className: "success"
                     })
                  }
                  else
                  {
                     $.notify(data.message, {
                        globalPosition: "top right",
                        className: "error"
                     })
                  }
               }
            });
         }
      }
   </script>
}