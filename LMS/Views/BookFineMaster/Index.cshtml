@model LMS.Models.BookFineMaster
@{
    ViewBag.Title = "Index";
}

<center><h2>BookFine Master</h2></center>
<div class="p-2">
   <a class="btn btn-success" style="margin-bottom:10px" onclick="PopupForm('@Url.Action("InsertOrUpdate")/0')"><i class="fa fa-plus"></i> Add New</a>
      @{ Html.RenderPartial("_FilterData"); }
   <table id="BookFineMasterTable" class="table table-striped table-bordered" style="width:100%">
       <thead>
           <tr>
               <th>Id</th>
               <th>Book Type</th>
               <th>Fine Type</th>
               <th>Late Fee Base Charge Amount</th>
               <th>Late Fee Base Charge Percent</th>
               <th>Late Fee Increase Amount</th>
               <th>Late Fee Increase Percentage</th>
               <th>IsDeleted</th>
               <th>Control</th>
           </tr>
       </thead>
   </table>
</div>

@section scripts{
   <script type="text/javascript">
      $('#filterRecord').find('input').change(function() {
         bindDatatable(this.value)
      });

      var Popup, dataTable;
      $(document).ready(function () {
         bindDatatable(0);
      });

      function bindDatatable(displayRecords)
      {
         $('#BookFineMasterTable').dataTable({
            "bDestroy": true
         }).fnDestroy();

         debugger;
         dataTable =  $("#BookFineMasterTable").DataTable({
            "ajax": {
               "url": "/BookFineMaster/GetData/",
               "data": { "displayRecords" : displayRecords },
               "type": "GET",
               "datatype": "json"
            },
            "columns": [
               { "data": "Id" },
               { "data": "BookType" },
               { "data": "FineType" },
               { "data": "LateFeeBaseChargeAmount" },
               { "data": "LateFeeBaseChargePercent" },
               { "data": "LateFeeIncreaseAmount" },
               { "data": "LateFeeIncreasePercentage" },
               { "data": "IsDeleted" },
               { "data": "Id" ,
               "render" : function (data, isDeleted) {
               debugger;
                  return "<a class='btn btn-primary btn-sm" + (data.IsDeleted ? " disabled" : "") + "' onclick=PopupForm('@Url.Action("InsertOrUpdate")/" + data + "')>"
                  + " <i class='fa fa-pencil'></i> Edit</a>"
                  + " <a class='btn btn-danger btn-sm' style='margin-left:5px' onclick=Delete("+data+")><i class='fa fa-trash'></i> Delete</a>";
               },
                  "orderable": false,
                  "searchable":true,
                  "scrollX":true
               }
            ],
            "language": {
               "emptyTable" : "No bookFines found, Please click on <b>Add New</b> Button",  
               "processing" : "<i class='fa fa-spinner fa-spin fa-3x fa-fw' style='color:#2a2b2b;'></i><span class='sr-only'>Loading...</span>" 
            }
         });
      };

      function PopupForm(url) {
         debugger;
         $.get(url)
         .done(function (response) {
            var formDiv = $('<div class="modal" data-backdrop="static"/>')
            formDiv.html(response)
            debugger;
            formDiv.modal('show');
         });
      }

      function SubmitForm(form) {
      debugger;
      $.validator.unobtrusive.parse(form);
      if($(form).valid()){
         $.ajax({
            type : "POST",
            url : form.action,
            data : $(form).serialize(),
            success : function (data) {
               if(data.success)
               {
                  debugger;
                  $.notify(data.message,{
                     globalPosition :"top right",
                     className : "success"
                  })

                  $('.modal').modal('hide');
                  dataTable.ajax.reload();
               }
               else
               {
                  debugger;
                  $.notify(data.message,{
                     globalPosition :"top right",
                     className : "error"
                  })
               }
            }
         });
      }
      return false;
   }

      function Delete(id) {
         if(confirm('Are You Sure to Delete this BookFineMaster Record ?'))
         {
            $.ajax({
               type: "POST",
               data: { "Id": id, "IsDeleted": true },
               url: '@Url.Action("InsertUpdateOrDelete","BookFineMaster")',
               success: function (data) {
                  if (data.success)
                  {
                     dataTable.ajax.reload();
                     $.notify(data.message, {
                        globalPosition: "top right",
                        className: "success"
                     })
                  }
                  else
                  {
                     $.notify(data.message, {
                        globalPosition: "top right",
                        className: "error"
                     })
                  }
               }
            });
         }
      }

      $(document).mouseup(function(e) 
      {
          var container = $("#popup-form");

          // if the target of the click isn't the container nor a descendant of the container
          if (!container.is(e.target) && container.has(e.target).length === 0) 
          {
              container.hide();
          }
      });
   </script>
}